<!DOCTYPE html>

<head>
    <title>Home</title>
</head>
<body>
<p>
    聊天室
</p>

<form id="wiselyForm">
    <textarea id="text" rows="4" cols="60" name="text"></textarea>
    <input type="submit"/>
</form>
<script src="jquery.js"></script>
<script>
	var $text = $('#text');
    $('#wiselyForm').submit(function(e){
        e.preventDefault();
        var text = $('#wiselyForm').find('textarea[name="text"]').val();
        sendSpittle(text);
    });

		// 初始化一个 WebSocket 对象
	var url = "ws://localhost:80/weChat/server/aa"
	var ws = new WebSocket(url);
	function sendSpittle(text){
		ws.send('{"userid":"001","message":'+text+'}');
	}
	// 建立 web socket 连接成功触发事件
	ws.onopen = function () {
	  // 使用 send() 方法发送数据
	};
	
	// 接收服务端数据时触发事件
	ws.onmessage = function (evt) {
	  var received_msg = evt.data;
	  $text.val(received_msg);
	};
	
	// 断开 web socket 连接成功触发事件
	ws.onclose = function () {
	};
	
</script>

<div id="output"></div>
</body>
</html>